<div class="items-start w-full px-10 lg:px-20 mx-auto my-20 lg:my-24">
  <div class="flex gap-10">
    <div class="items-start hidden lg:block h-96 xl:h-[28rem] w-11/12 relative">
      <div class="carousel-container relative h-full w-full">
        <a routerLink="/" class="carousel-item h-full w-full focus:outline-none flex">
          <img *ngIf="car && car.images && car.images.length > imageIndex"
            class="absolute object-cover w-full h-full hover:shadow-lg rounded-xl"
            [src]="url + car.images[imageIndex].imageUrl">
        </a>
        <button *ngIf="imageIndex > 0"
          class="absolute focus:outline-none top-1/2 -translate-y-1/2 hover:bg-white hover:bg-opacity-25 hover:backdrop-blur-sm p-3 left-2 rounded-lg text-3xl text-white transition-colors hover:text-gray-800"
          (click)="prevImage()">
          <i class="fas fa-chevron-left"></i>
        </button>
        <div class="flex justify-center w-full absolute bottom-0">
          <div class="space-x-2 bg-white bg-opacity-20 backdrop-blur-sm py-2 px-3 rounded-t-lg">
            <button *ngFor="let image of car.images; let i = index"
              class="w-5 h-2 rounded-md hover:bg-gray-300 transition-colors cursor-pointer"
              [ngClass]="{'bg-gray-700': imageIndex === i, 'bg-gray-100': imageIndex !== i}" (click)="changePage(i)">
            </button>
          </div>
        </div>

        <button *ngIf="car && car.images && imageIndex < car.images.length - 1"
          class="absolute focus:outline-none top-1/2 -translate-y-1/2 hover:bg-white hover:bg-opacity-25 hover:backdrop-blur-sm p-3 right-2 rounded-lg text-3xl text-white transition-colors hover:text-gray-800"
          (click)="nextImage()">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      <button (click)="handleFavorites(car)" attr.data-car-id="{{car.id}}"
        class="absolute -top-1 left-10 text-6xl hover:text-yellow-500 hover:scale-105 transition-all text-gray-800 rounded-lg">
        <i class="fas fa-bookmark"></i>
      </button>
    </div>
    <div class="flex flex-col justify-between gap-6 lg:gap-8 md:gap-10 h-auto w-full">
      <div class="flex w-full justify-between order-1">
        <div class="flex flex-col gap-2 w-full">
          <div class="flex gap-5 justify-between">
            <div class="flex flex-col">
              <h1 id="title" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none font-bold text-2xl md:text-3xl lg:text-4xl text-gray-800 editable">
                {{car.title}}
              </h1>
              <div class="text-xl md:text-3xl font-bold flex gap-1 text-gray-800 lg:pb-0 pb-4">
                <p id="price" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none editable">
                  {{ car.price | thousandSeparator}} 
                </p>
                <p id="currency" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none editable">
                  {{ car.currency }}
                </p>
              </div>
            </div>
            <div class="flex-col gap-2 flex lg:hidden text-xs md:text-sm">
              <p class=" text-gray-600 rounded-2xl px-4 flex justify-end flex-shrink-0 items-center py-1">{{car.views}}
                <i class="fas fa-eye pl-2 pr-1"></i>
              </p>
              <p class=" text-gray-600 rounded-2xl px-4 flex justify-end flex-shrink-0 items-center py-1">{{car.saves}}
                <i class="fas fa-bookmark pl-2 pr-2"></i>
              </p>
            </div>
          </div>
          <div class="items-start block lg:hidden h-60 sm:h-80 w-full relative">
            <div class="carousel-container relative h-full w-full">
              <a routerLink="/" class="carousel-item h-full w-full focus:outline-none flex">
                <img *ngIf="car && car.images && car.images.length > imageIndex"
                  class="absolute object-cover w-full h-full hover:shadow-lg rounded-xl"
                  [src]="url + car.images[imageIndex].imageUrl">
              </a>
              <button *ngIf="imageIndex > 0"
                class="absolute focus:outline-none top-1/2 -translate-y-1/2 hover:bg-white hover:bg-opacity-25 hover:backdrop-blur-sm p-3 left-2 rounded-lg text-xl text-white transition-colors hover:text-gray-800"
                (click)="prevImage()">
                <i class="fas fa-chevron-left"></i>
              </button>

              <div class="flex justify-center w-full">
                <div
                  class="space-x-2 flex bg-white bg-opacity-20 backdrop-blur-sm py-2 sm:py-3 px-3 bottom-0 absolute items-center rounded-t-lg">
                  <button *ngFor="let image of car.images; let i = index"
                    class="w-3 h-1 sm:h-2 rounded-md hover:bg-gray-300 transition-colors cursor-pointer"
                    [ngClass]="{'bg-gray-700': imageIndex === i, 'bg-gray-100': imageIndex !== i}"
                    (click)="changePage(i)">
                  </button>
                </div>
              </div>

              <button *ngIf="car && car.images && imageIndex < car.images.length - 1"
                class="absolute focus:outline-none top-1/2 -translate-y-1/2 hover:bg-white hover:bg-opacity-25 hover:backdrop-blur-sm p-3 right-2 rounded-lg text-xl text-white transition-colors hover:text-gray-800"
                (click)="nextImage()">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
            <button (click)="handleFavorites(car)" attr.data-car-id="{{car.id}}"
              class="absolute -top-1 left-10 text-5xl hover:text-yellow-500 hover:scale-105 text-gray-800 transition-all rounded-lg">
              <i class="fas fa-bookmark"></i>
            </button>
          </div>
        </div>
        <div class="lg:flex-col gap-2 hidden text-sm lg:flex">
          <p class=" text-gray-600 rounded-2xl px-4 text-md flex justify-end flex-shrink-0 items-center py-1">
            {{car.views}} <i class="fas fa-eye pl-2 pr-1"></i></p>
          <p class=" text-gray-600 rounded-2xl px-4 text-md flex justify-end flex-shrink-0 items-center py-1">
            {{car.saves}} <i class="fas fa-bookmark pl-2 pr-2"></i></p>
        </div>
      </div>
      <div class="flex items-center order-3 lg:order-2 px-3">
        <div class="flex flex-col gap-1 lg:gap-2">
          <label
            class="peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-sm md:text-base lg:text-lg font-semibold text-gray-700"
            for="contact">
            Contact Information
          </label>
          <div class="flex items-center">
            <p *ngIf="!setContentEditable" class="text-sm md:text-base lg:text-lg text-gray-600 cursor-pointer self-center editable"
              [routerLink]="['/user/', car.owner.id]">
              {{ car.owner.username }}
            </p>
            <div class="relative">
              <p *ngIf="setContentEditable" id="owner" (click)="isEditingUser = !isEditingUser" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-nonetext-sm md:text-base lg:text-lg text-gray-600 cursor-pointer self-center editable">
                {{ car.owner.username }}
              </p>
              <div *ngIf="setContentEditable && isEditingUser" class="z-10 absolute mt-1 flex flex-col text-left h-44 overflow-y-auto bg-gray-100 rounded-lg p-3 gap-2 bg-opacity-80 scroll-hide backdrop-blur-md">
                <a *ngFor="let user of users; let i = index" class="h-8 text-sm md:text-base w-full cursor-pointer hover:bg-gray-200 bg-gray-50 transition-colors px-3 py-1 rounded-lg">{{user.username}}</a>
              </div>
            </div>
            <p class="pl-2 pr-1">-</p>
            <p class="cursor-pointer text-sm md:text-base lg:text-lg text-gray-700 self-center pl-1"
              (click)="togglePhoneNumber()">
              {{ showPhoneNumber ? '' : "Show phone number"}}
              <span *ngIf="showPhoneNumber">{{ car.owner.phone }}</span>
            </p>
          </div>
          <div class="flex text-sm md:text-base lg:text-lg items-center gap-1">
            <i class="fas fa-star text-gray-500"></i>
            <span class="text-gray-800">
              {{averageRating}}/5
            </span>
            <span class="text-gray-800">
              ({{ratingCount}})
            </span>
          </div>

        </div>
      </div>
      <div class="flex text-sm md:text-base lg:text-lg items-center gap-5 sm:gap-8 lg:gap-10 order-2 lg:order-3 px-3">
        <div class="flex items-center gap-2">
          <i class="fas fa-map-marker-alt text-gray-600"></i>
          <p class="text-gray-800">
            {{car.location}}
          </p>
        </div>
        <div class="flex items-center gap-2">
          <i class="fas fa-calendar-alt text-gray-600"></i>
          <p id="year" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-gray-800 editable">
            {{car.year}}
          </p>
        </div>
        <div class="flex items-center gap-2">
          <i class="fa-solid fa-tag text-gray-600"></i>
          <p id="color" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-gray-800 editable">
            {{car.color | capitalizeFirst}}
          </p>
        </div>
      </div>
      <div class="flex gap-1 order-4">
        <button
          class="justify-center text-md font-medium focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 h-11 rounded-lg bg-black text-white hover:bg-gray-800 transition-colors w-full">
          Contact Seller
        </button>
        <button *ngIf="isCurrentUserOwner(car)" (click)="setEditable()"
        [ngClass]="{'bg-green-500 hover:bg-green-600': setContentEditable, 'bg-yellow-400 hover:bg-yellow-500': !setContentEditable}"
          class="justify-center text-md font-medium focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 h-11 rounded-lg text-white transition-all w-2/12 sm:w-1/12">
          <i [ngClass]="{'fa-check': setContentEditable, 'fa-pencil': !setContentEditable}" class="fa px-2"></i>
        </button>
        <button *ngIf="isCurrentUserOwner(car)"
          class="justify-center text-md font-medium focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 h-11 rounded-lg bg-red-500 text-white hover:bg-red-600 transition-colors w-2/12 sm:w-1/12"
          (click)="openDeleteModal(car.id)">
          <i class="fa fa-trash px-2"></i>
        </button>
      </div>
    </div>
  </div>
  <div class="flex py-12">
    <div class="aditional-information space-y-10 w-full">
      <div class="flex flex-col md:flex-row w-full space-y-8 md:space-y-0">
        <div class="flex justify-around w-full">
          <div class="flex flex-col items-center gap-3">
            <i class="fas fa-car text-3xl text-gray-700"></i>
            <p id="brand" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-sm text-gray-800 font-semibold editable">
              {{car.brand | capitalizeFirst}}
            </p>
          </div>
          <div class="flex flex-col items-center gap-3">
            <i class="fas fa-tag text-3xl text-gray-700"></i>
            <p id="model" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-sm text-gray-800 font-semibold editable">
              {{car.model | capitalizeFirst}}
            </p>
          </div>
          <div class="flex flex-col items-center gap-3">
            <i class="fas fa-gas-pump text-3xl text-gray-700"></i>
            <p id="fuel" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-sm text-gray-800 font-semibold editable">
              {{car.fuel | capitalizeFirst}}
            </p>
          </div>
        </div>
        <div class="flex justify-around w-full">
          <div class="flex flex-col items-center gap-3">
            <i class="fas fa-cogs text-3xl text-gray-700"></i>
            <p id="gearbox" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-sm text-gray-800 font-semibold editable">
              {{car.gearbox | capitalizeFirst}}
            </p>
          </div>
          <div class="flex flex-col items-center gap-3">
            <i class="fas fa-chair text-3xl text-gray-700"></i>
            <div [ngClass]="{'animate-pulse italic':setContentEditable}" class="flex items-center gap-1 font-semibold">
              <p id="seats" class="focus:outline-none text-sm text-gray-800 editable">
                {{car.seats}}
              </p>
              <p class="text-sm text-gray-800">
                seats
              </p>
            </div>
          </div>
          <div class="flex flex-col items-center gap-3">
            <i class="fas fa-door-open text-3xl text-gray-700"></i>
            <div [ngClass]="{'animate-pulse italic':setContentEditable}" class="flex items-center gap-1 font-semibold">
              <p id="doors" class="focus:outline-none text-sm text-gray-800 editable">
                {{car.doors}}
              </p>
              <p class="text-sm text-gray-800">
                doors
              </p>
            </div>
          </div>
        </div>
      </div>
      <hr
        *ngIf="car.distance || car.type || car.horsepower || car.plate || car.dgtSticker || car.lastITV || car.consumption || car.emissions || car.acceleration || car.drive || car.engine"
        class="border-2 rounded-lg border-gray-600">
      <div
        *ngIf="car.distance || car.type || car.horsepower || car.plate || car.dgtSticker || car.lastITV || car.consumption || car.emissions || car.acceleration || car.drive || car.engine"
        class="flex">
        <div class="flex justify-evenly space-x-5 w-full overflow-x-scroll scroll-hide">
          <!-- <div *ngIf="car.plate"
            class="flex flex-row bg-gray-200 hover:bg-gray-300 transition-colors rounded-lg hover:shadow-sm">
            <div class="bg-blue-600 p-5 rounded-l-lg text-white">
              <p class="text-xl font-bold">E</p>
            </div>
            <div class="self-center w-full px-5 text-black">
              <h1 class="text-3xl font-bold text-center">{{car.plate}}</h1>
            </div>
          </div>
          <div *ngIf="car.dgtSticker" class="flex flex-col items-center gap-2">
            <p>DGT Sticker:</p>
            <p class="text-gray-800 py-1 px-3 text-lg font-bold rounded-3xl hover:shadow-sm" [ngClass]="{
                'bg-green-500': car.dgtSticker === 'C',
                'bg-yellow-300': car.dgtSticker === 'B',
                'bg-blue-500': car.dgtSticker === '0',
                'eco-gradient': car.dgtSticker === 'ECO'
              }">
              {{car.dgtSticker}}
            </p>
          </div> -->
          <div *ngIf="car.distance" class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">Distance:</p>
            <div [ngClass]="{'animate-pulse italic':setContentEditable}" class="flex gap-1 p-2">
              <p id="distance" class="focus:outline-none text-sm text-gray-800 font-bold editable">
                {{ car.distance | roundToThousandth }}
              </p>
              <p class="text-sm text-gray-800 font-bold">
                km
              </p>
            </div>
          </div>
          <div *ngIf="car.type" class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">Type:</p>
            <p id="type" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-sm text-gray-800 p-2 font-bold editable">
              {{car.type | capitalizeFirst}}
            </p>
          </div>
          <div *ngIf="car.horsepower" class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">Horsepower:</p>
            <div [ngClass]="{'animate-pulse italic':setContentEditable}" class="flex gap-1 p-2">
              <p id="horsepower" class="focus:outline-none text-sm text-gray-800 font-bold editable">
                {{ car.horsepower | thousandSeparator }}
              </p>
              <p class="text-sm text-gray-800 font-bold">
                hp
              </p>
            </div>
          </div>
          <div *ngIf="car.consumption" class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">Last ITV:</p>
            <p id="lastITV" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-sm text-gray-800 p-2 font-bold editable">
              {{ car.lastITV | date: 'MM/yyyy' }}
            </p>
          </div>
          <div *ngIf="car.consumption" class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">Consumption:</p>
            <div [ngClass]="{'animate-pulse italic':setContentEditable}" class="flex gap-1 p-2">
              <p id="consumption" class="focus:outline-none text-sm text-gray-800 font-bold editable">
                {{ car.consumption }}
              </p>
              <p class="text-sm text-gray-800 font-bold">
                l/100km
              </p>
            </div>
          </div>
          <div *ngIf="car.emissions" class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">Emissions:</p>
            <div [ngClass]="{'animate-pulse italic':setContentEditable}" class="flex gap-1 p-2">
              <p id="emissions" class="focus:outline-none text-sm text-gray-800 font-bold editable">
                {{ car.emissions }}
              </p>
              <p class="text-sm text-gray-800 font-bold">
                g CO2/km
              </p>
            </div>
          </div>
          <div *ngIf="car.acceleration"
            class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">0-100km/h:</p>
            <div [ngClass]="{'animate-pulse italic':setContentEditable}" class="flex gap-1 p-2">
              <p id="acceleration" class="focus:outline-none text-sm text-gray-800 font-bold editable">
                {{ car.acceleration }}
              </p>
              <p class="text-sm text-gray-800 font-bold">
                s
              </p>
            </div>
          </div>
          <div *ngIf="car.drive" class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">Drive:</p>
            <p id="drive" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-sm text-gray-800 p-2 font-bold editable">
              {{car.drive.toUpperCase()}}
            </p>
          </div>
          <div *ngIf="car.engine" class="flex flex-col items-center p-3 bg-gray-100 rounded-[2.3em] flex-shrink-0">
            <p class="text-sm px-1">Engine:</p>
            <p id="engine" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-sm text-gray-800 p-2 font-bold editable">
              {{car.engine.toUpperCase()}}
            </p>
          </div>
        </div>
      </div>

      <div class="flex flex-col gap-10">
        <div class="flex flex-col lg:flex-row h-full gap-10">
          <div class="w-full lg:w-1/2 max-h-64 min-h-10 lg:max-h-96 overflow-y-auto rounded-scrollbar">
            <p id="description" [ngClass]="{'animate-pulse italic':setContentEditable}" class="focus:outline-none text-gray-700 h-full overflow-y-auto pr-5 rounded-scrollbar px-3 lg:px-0 editable">
              {{car.description}}
            </p>
          </div>
          <div id="map" class="bg-sky-500 rounded-xl w-full h-64 lg:h-96">
          </div>
        </div>
        <div>
          <apx-chart [chart]="chart.chart" [series]="chart.series" [markers]="chart.markers" [xaxis]="chart.xaxis"
            [yaxis]="chart.yaxis" [title]="chart.title" [stroke]="chart.stroke" [tooltip]="chart.tooltip"
            [dataLabels]="chart.dataLabels" [fill]="chart.fill"></apx-chart>
        </div>
      </div>

    </div>
  </div>

  <div *ngIf="isDeleteModalVisible" (click)="closeDeleteModal()"
    class="fixed inset-0 bg-gray-400 backdrop-blur-md bg-opacity-50 h-full w-full flex items-center justify-center"
    id="my-modal">
    <div (click)="$event.stopPropagation()"
      class="p-5 border w-96 shadow-lg rounded-xl bg-white bg-opacity-75 backdrop-blur-lg">
      <div class="mt-3 text-center">
        <h3 class="text-lg leading-6 font-medium text-gray-900">
          <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>Confirm Deletion
        </h3>
        <div class="mt-2 px-7 py-3">
          <p class="text-sm text-gray-500">
            Are you sure you want to delete this car?
          </p>
          <p class="text-sm text-gray-500">
            This action cannot be undone.
          </p>
        </div>
        <div class="flex items-center justify-evenly px-4 py-3 sm:flex-row flex-col">
          <button id="ok-btn" (click)="deleteCar()"
            class="flex items-center justify-center px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300 transition-colors w-full sm:w-auto">
            <i class="fas fa-check mr-2"></i>Confirm
          </button>
          <button id="cancel-btn" (click)="closeDeleteModal()"
            class="flex items-center justify-center px-4 py-2 bg-gray-100 text-gray-900 text-base font-medium rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-200 transition-colors w-full sm:w-auto">
            <i class="fas fa-times mr-2"></i>Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>