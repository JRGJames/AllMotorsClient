<div class="flex items-center justify-center h-screen px-6 md:px-12 py-6 md:py-10 bg-cover bg-center relative"
  [ngStyle]="{'background-image': backgroundImage}" loading="lazy">
  <div class="inset-0 backdrop-blur-md h-full absolute"></div>

  <form [formGroup]="carForm"
    class="w-full px-6 bg-gray-50 bg-opacity-95 backdrop-blur-none shadow-xl overflow-y-auto h-[90%] rounded-3xl mt-10 scroll-hide py-6 lg:p-6 grid gap-10">
    <div class="flex flex-col gap-10">

      <h2 class="font-semibold text-lg lg:text-2xl">Basic information</h2>

      <div class="flex gap-10 flex-col lg:flex-row">
        <div [ngStyle]="{'background-image': inputImage}" loading="lazy"
          class="flex w-full lg:w-1/2 rounded-xl items-center bg-cover bg-center justify-center h-40 md:h-60 lg:h-full">

          <button (click)="closeDropdowns()">
            <label for="images"
              class="cursor-pointer flex items-center justify-center gap-3 w-full rounded-xl bg-gray-50 bg-opacity-40 backdrop-blur-[8px] hover:backdrop-blur-[10px] transition-all px-5 py-4 md:px-10 md:py-8 text-gray-800 hover:text-gray-700">
              <i class="fas fa-camera text-3xl md:text-5xl"></i>
              <p class="text-2xl md:text-3xl font-semibold">Add images</p>
            </label>
            <input type="file" formControlName="images" id="images" (change)="handleFileInput($event)" multiple
              accept="image/*" class="hidden">
          </button>
          <!-- <div class="rounded-xl flex items-center h-36 self-center justify-center">
            <input type="file" formControlName="images" id="images" (change)="handleFileInput($event)" multiple
                accept="image/*"
                class="file:rounded-lg file:text-sm file:border-0 file:px-4 file:py-2 file:font-base file:bg-sky-500 file:text-white hover:file:bg-sky-600 file:mx-3 file:my-3 file:focus:ring-sky-400 file:focus:outline-none file:focus:ring-2 file:focus:ring-offset-2 focus:outline-none file:transition-all">
          </div> -->
        </div>

        <div class="flex flex-col gap-10 w-full lg:w-1/2">

          <div class="flex flex-col sm:flex-row gap-10 sm:gap-5 xl:gap-10">
            <!-- Title -->
            <div [ngClass]="{'sm:w-full': !currentUser.role, 'sm:w-3/5': currentUser.role}"
              class=" w-full order-2 sm:order-1">
              <label for="title" class="font-base">Title</label>
              <input type="text" id="title" formControlName="title" (focus)="closeDropdowns()"
                class="mt-2 w-full rounded-lg shadow-sm bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2"
                value="{{title}}" placeholder="Perfect condition">
            </div>

            <!--Owner-->
            <div *ngIf="currentUser.role" class="w-full sm:w-2/5 order-1 sm:order-2 relative">
              <label for="owner" class="font-base">Owner</label>
              <input type="text" id="owner" formControlName="owner"
                (click)="showUsers = !showUsers; showBrands = false; showModels = false; showYears = false; showColors = false"
                #ownerInput
                class="mt-2 w-full rounded-lg shadow-sm bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2"
                [value]="user.username" placeholder="User">
              <div [ngClass]="{'h-0': !showUsers, 'h-36 py-2': showUsers}"
                class="z-10 gap-2 flex flex-col absolute top-20 w-full overflow-y-auto transition-all rounded-xl shadow-lg bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none scroll-hide focus:ring-2 focus:ring-offset-2 px-2 ">
                <button *ngFor="let user of users"
                  (click)="carForm.patchValue({owner: user.username}); showUsers = !showUsers"
                  [ngClass]="{'bg-gray-400':carForm.get('owner')?.value === user.username || ownerInput.value === user.username}"
                  class="bg-gray-300 hover:bg-gray-400 rounded-xl transition-colors duration-150 px-3 py-2 gap-2 justify-start flex items-center">
                  <div class="rounded-full overflow-hidden bg-gray-500 h-6 w-6">
                    <img *ngIf="user.profilePicture" [src]="urlImage + user.profilePicture" alt=""
                      class="flex h-full object-cover w-full items-center justify-center">
                    <div *ngIf="!user.profilePicture"
                      class="flex w-full h-full justify-center items-center text-xs text-white bg-sky-600">
                      {{getUserInitials(user)}}
                    </div>
                  </div>
                  {{ user.username }}
                </button>
              </div>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row gap-10 md:gap-5 xl:gap-10 w-full">
            <!--Price-->
            <div class="flex flex-col w-full sm:w-3/5">
              <label for="price" class="font-base text-gray-700">Price</label>
              <input type="number" id="price" formControlName="price" (focus)="closeDropdowns()"
                class="mt-2 rounded-lg shadow-sm bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2"
                placeholder="0">
            </div>

            <!--Currency-->
            <div class="flex flex-col w-full sm:w-2/5">
              <label for="currency" class="font-base text-gray-700">Currency</label>
              <div class="mt-2 flex h-10 justify-between bg-gray-200 rounded-lg px-1 py-1 text-sm gap-1">
                <button *ngFor="let currency of currencies; let i = index" value="{{currency}}"
                  (click)="carForm.patchValue({currency: currency}); closeDropdowns()"
                  [ngClass]="{'bg-gray-400':carForm.get('currency')?.value === currency}"
                  class="flex items-center px-4 w-full justify-center sm:px-3 lg:px-2 xl:px-3 2xl:px-4 py-1 bg-gray-300 hover:bg-gray-400 transition-colors rounded-lg h-full">
                  {{currency}}
                </button>
              </div>
            </div>
          </div>


          <div class="flex w-full flex-col md:flex-row gap-5 xl:gap-10">
            <!-- Brand -->
            <div class="flex flex-col w-full md:w-1/2 relative">
              <label for="brand" class=" font-base text-gray-700">Brand</label>
              <input type="text" id="brand" formControlName="brand" (change)="changeTitleBrand($event)"
                (click)="showBrands = !showBrands; showUsers = false; showModels = false; showYears = false; showColors = false"
                class="mt-2 w-full rounded-lg shadow-sm bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2">
              <div (change)="changeTitleBrand($event); onBrandChange($event)"
                [ngClass]="{'h-0': !showBrands, 'h-36 py-2': showBrands}"
                class="z-10 gap-2 flex flex-col absolute top-20 w-full overflow-y-auto transition-all rounded-xl shadow-lg bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none scroll-hide focus:ring-2 focus:ring-offset-2 px-2 ">
                <button *ngFor="let brand of brands"
                  (click)="carForm.patchValue({brand: brand}); showBrands = !showBrands"
                  [ngClass]="{'bg-gray-400':carForm.get('brand')?.value === brand}"
                  class="bg-gray-300 hover:bg-gray-400 rounded-xl transition-colors focus:bg-gray-400 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 duration-150 px-3 py-1">{{
                  brand
                  }}</button>
              </div>
            </div>

            <!-- Model -->
            <div class="flex flex-col w-full md:w-1/2 relative">
              <label for="model" class=" font-base text-gray-700">Model</label>
              <input type="text" id="model" formControlName="model" (change)="changeTitleModel($event)"
                (click)="showModels = !showModels; showUsers = false; showBrands = false; showYears = false; showColors = false"
                class="mt-2 w-full rounded-lg shadow-sm bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2">
              <div (change)="changeTitleModel($event)" [ngClass]="{'h-0': !showModels, 'h-36 py-2': showModels}"
                class="z-10 gap-2 flex flex-col absolute top-20 w-full overflow-y-auto transition-all rounded-xl shadow-lg bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none scroll-hide focus:ring-2 focus:ring-offset-2 px-2 ">
                <button *ngFor="let model of models"
                  (click)="carForm.patchValue({model: model}); showModels = !showModels"
                  [ngClass]="{'bg-gray-400':carForm.get('model')?.value === model}"
                  class="bg-gray-300 hover:bg-gray-400 rounded-xl transition-colors focus:bg-gray-400 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 duration-150 px-3 py-1">{{
                  model
                  }}</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-col gap-10 lg:gap-10">
        <div class="flex flex-col lg:flex-row w-full gap-10">
          <div class="flex gap-5 xl:gap-10 w-full">
            <!--Year-->
            <div class="flex flex-col w-full lg:w-1/2 relative">
              <label for="year" class=" font-base text-gray-700">Year</label>
              <input type="text" id="year" formControlName="year"
                (click)="showYears = !showYears; showUsers = false; showBrands = false; showModels = false; showColors = false"
                class="mt-2 w-full rounded-lg shadow-sm bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2">
              <div [ngClass]="{'h-0': !showYears, 'h-36 py-2': showYears}"
                class="z-10 gap-2 flex flex-col absolute top-20 w-full overflow-y-auto transition-all rounded-xl shadow-lg bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none scroll-hide focus:ring-2 focus:ring-offset-2 px-2 ">
                <button *ngFor="let year of years" (click)="carForm.patchValue({year: year}); showYears = !showYears"
                  [ngClass]="{'bg-gray-400':carForm.get('year')?.value === year}"
                  class="bg-gray-300 hover:bg-gray-400 rounded-xl transition-colors focus:bg-gray-400 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 duration-150 px-3 py-1">{{
                  year
                  }}</button>
              </div>
            </div>

            <!--Color-->
            <div class="flex flex-col w-full lg:w-1/2 relative">
              <label for="color" class=" font-base text-gray-700">Color</label>
              <input type="text" id="color" formControlName="color"
                [value]="carForm.get('color')?.value | capitalizeFirst"
                (click)="showColors = !showColors; showUsers = false; showBrands = false; showModels = false; showYears = false"
                class="mt-2 w-full rounded-lg shadow-sm bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2">
              <div [ngClass]="{'h-0': !showColors, 'h-36 py-2': showColors}"
                class="shadow-lg z-10 gap-2 flex flex-col absolute top-20 w-full overflow-y-auto transition-all rounded-xl bg-gray-200 focus:bg-gray-200 focus:ring-gray-400 focus:outline-none scroll-hide focus:ring-2 focus:ring-offset-2 px-2 ">
                <button *ngFor="let color of colors"
                  (click)="carForm.patchValue({color: color.color}); showColors = !showColors"
                  [ngClass]="{'bg-gray-400':carForm.get('color')?.value === color.color}"
                  class="bg-gray-300 hover:bg-gray-400 rounded-xl transition-colors focus:bg-gray-400 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 duration-150 px-3 py-1 items-center flex gap-3">
                  <div [ngStyle]="{'background-color': color.hex}" class="rounded-xl hidden sm:flex h-4 w-10"></div>
                  {{ color.color | capitalizeFirst }}
                </button>
              </div>
            </div>
          </div>

          <div class="flex w-full gap-5 xl:gap-10">

            <!--Seats-->
            <div class="flex flex-col w-full lg:w-1/2 relative">
              <label for="seats" class="font-base text-gray-700">Seats</label>
              <input type="number" id="seats" formControlName="seats" (focus)="closeDropdowns()"
                class="mt-2 w-full rounded-lg shadow-sm bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2">
            </div>

            <!--Doors-->
            <div class="flex flex-col w-full lg:w-1/2 relative">
              <label for="doors" class="font-base text-gray-700">Doors</label>
              <input type="number" id="doors" formControlName="doors" (focus)="closeDropdowns()"
                class="mt-2 w-full rounded-lg shadow-sm bg-gray-200 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 px-3 py-2">
            </div>
          </div>
        </div>

        <div class="flex flex-col md:flex-row gap-10 w-full">

          <!-- Description -->
          <div class="h-full flex flex-col w-full md:w-2/5 order-2 md:order-1">
            <label for="description">Description</label>
            <span name="description" id="description" formControlName="description" #descriptionSpan
              class="description mt-2 block rounded-lg p-3 w-full resize-none box-border scroll-hide overflow-y-auto bg-gray-200 min-h-20 max-h-72 md:min-h-72 md:max-h-72 leading-6 focus:ring-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2"
              contenteditable (focus)="closeDropdowns()"></span>
          </div>

          <!-- Location -->
          <div class="w-full md:w-3/5 order-1 md:order-2">
            <label for="location" class="font-base text-gray-700">Location</label>
            <div class="bg-sky-300 rounded-xl h-64 md:h-72 mt-2">

            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-col lg:flex-row w-full gap-10">
        <!-- Gearbox -->
        <div class="flex flex-col w-full lg:w-1/3">
          <label for="gearbox" class="font-base text-gray-700">Gearbox</label>

          <div class="mt-2 flex gap-5">
            <button *ngFor="let gearbox of gearboxTypes; let i = index" value="{{gearbox}}"
              (click)="carForm.patchValue({gearbox: gearbox}); closeDropdowns()"
              [ngClass]="{'bg-gray-300':carForm.get('gearbox')?.value === gearbox}"
              class="flex justify-center flex-col items-center gap-1 py-2 px-4 w-1/2 h-24 shadow-sm text-sm font-base rounded-xl text-white bg-gray-200 hover:bg-gray-300 focus:bg-gray-300 transition-all focus:outline-none">
              <svg *ngIf="gearbox === 'manual'" xmlns="http://www.w3.org/2000/svg"
                class="icon icon-tabler icon-tabler-manual-gearbox" width="30" height="30" viewBox="0 0 24 24"
                stroke-width="2" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M5 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                <path d="M12 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                <path d="M19 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                <path d="M5 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                <path d="M12 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                <path d="M5 8l0 8" />
                <path d="M12 8l0 8" />
                <path d="M19 8v2a2 2 0 0 1 -2 2h-12" />
              </svg>
              <svg *ngIf="gearbox === 'automatic'" xmlns="http://www.w3.org/2000/svg"
                class="icon icon-tabler icon-tabler-automatic-gearbox" width="30" height="30" viewBox="0 0 24 24"
                stroke-width="2" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M17 17v4h1a2 2 0 1 0 0 -4h-1z" />
                <path d="M17 11h1.5a1.5 1.5 0 0 0 0 -3h-1.5v5" />
                <path d="M5 5m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                <path d="M5 7v3a1 1 0 0 0 1 1h3v7a1 1 0 0 0 1 1h3" />
                <path d="M9 11h4" />
              </svg>
              <p class="text-sm text-gray-600">{{gearbox | capitalizeFirst}}</p>
            </button>
          </div>
        </div>

        <!-- Fuel -->
        <div class="flex flex-col w-full lg:w-2/3">
          <label for="fuel" class="font-base text-gray-700">Fuel type</label>

          <div class="mt-2 gap-5 grid grid-cols-2 lg:grid-cols-4">
            <button *ngFor="let fuel of fuelTypes; let i = index" value="{{fuel}}"
              (click)="carForm.patchValue({fuel: fuel}); closeDropdowns()"
              [ngClass]="{'bg-gray-300':carForm.get('fuel')?.value === fuel}"
              class="justify-center py-2 px-4 w-full shadow-sm h-24 text-sm font-base rounded-xl text-white bg-gray-200 hover:bg-gray-300 focus:bg-gray-300 transition-all focus:outline-none">
              <i [ngClass]="{'fa-gas-pump': fuel === 'gasoline' || 'diesel', 'fa-bolt': fuel === 'electric', 'fa-charging-station': fuel === 'hybrid'}"
                class="fas text-2xl text-gray-700 py-2"></i>
              <p class="text-sm text-gray-600">{{fuel |capitalizeFirst}}</p>
            </button>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="flex flex-col md:flex-row justify-between gap-5">
        <button type="button" (click)="fillFormWithDefaults(); closeDropdowns()"
          class="flex justify-center items-center py-2 px-4 shadow-sm text-sm font-base rounded-lg text-white bg-blue-500 hover:bg-blue-600 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          Fill Form With Defaults
        </button>

        <div class="flex justify-between gap-5">
          <button [routerLink]="['/']" (click)="closeDropdowns()"
            class="flex justify-center items-center gap-2 py-2 px-4 shadow-sm text-xs sm:text-sm lg:text-base font-base rounded-lg text-white bg-red-400 hover:bg-red-500 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
            Cancel
            <i class="fa-solid fa-right-from-bracket"></i>
          </button>
          <button type="submit" (click)="closeDropdowns()"
            class="flex justify-center items-center gap-2 py-2 px-4 border border-transparent shadow-sm font-base rounded-md text-white bg-sky-500 hover:bg-sky-600 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 text-xs sm:text-sm lg:text-base">
            Publish
            <i class="fas fa-upload"></i>
          </button>
        </div>
      </div>
    </div>
  </form>
</div>