<div *ngIf="chat.memberOne === undefined">
    hola
</div>
<div *ngIf="chat.memberOne !== undefined" class="w-full h-full flex flex-col bg-cover bg-center"
    [ngStyle]="{'background-image': selectedBackgroundImage}" loading="lazy">
    <div class="h-[9.5rem] pt-16 bg-gray-50 bg-opacity-[0.63] backdrop-blur-lg px-4">
        <div class="flex items-center justify-between h-full px-4">
            <div class="flex items-center gap-4 justify-between w-full">
                <div class="flex gap-3">
                    <div class="rounded-full overflow-hidden bg-gray-500 h-full w-10 aspect-square">
                        <img *ngIf="receiver.profilePicture" [src]="urlImage + receiver.profilePicture"
                            alt="chat receiver image"
                            class="flex h-full object-cover w-full items-center justify-center">
                        <div *ngIf="!receiver.profilePicture"
                            class="flex w-full h-full justify-center items-center text-xs text-white bg-sky-600">
                            {{ getUserInitials(receiver) }}
                        </div>
                    </div>
                    <div class="flex flex-col justify-between">
                        <div class="flex items-end gap-1">
                            <p>{{ receiver.username }}</p>
                            <p *ngIf="chat.car" class="text-gray-800"> - {{ chat.car.title }}</p>
                        </div>
                        <p class="italic text-xs text-gray-600">{{ receiver.status ? 'Online' : 'Offline' }}</p>
                    </div>
                </div>
                <button class="w-auto h-10 flex gap-2 items-center">
                    <p>Options</p>
                    <i class="fa fa-ellipsis-vertical"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="w-auto h-full flex flex-col p-3 px-4 overflow-y-auto scroll-chat" #messageContainer>
        <div *ngFor="let message of messages; let i = index" class="w-full flex flex-col py-1">
            <ng-container *ngIf="shouldShowDate(i)">
                <div class="text-center w-full my-2 text-gray-700 flex justify-center">
                    <p class="py-1 px-4 w-fit text-sm bg-gray-50 backdrop-blur-sm rounded-2xl bg-opacity-55">{{
                        messages[i].sentTime | date:'fullDate' }}</p>
                </div>
            </ng-container>
            <div [ngClass]="{
                        'bg-sky-500 text-white self-end': message.sender.id === currentUser.id,
                        'bg-white self-start': message.sender.id !== currentUser.id,
                        'rounded-tr-none': (i !== 0 && messages[i].sender.id !== messages[i - 1].sender.id && message.sender.id === currentUser.id) || (i === 0 && message.sender.id === currentUser.id),
                        'rounded-tl-none': (i !== 0 && messages[i].sender.id !== messages[i - 1].sender.id && message.sender.id !== currentUser.id) || (i === 0 && message.sender.id !== currentUser.id)
                      }" (dblclick)="likeMessage(message)"
                class="bg-opacity-95 rounded-lg p-1 px-3 w-auto flex flex-col relative items-end max-w-[60%] shadow-md">
                <span class="text-[15px] relative min-w-full justify-between">
                    <ng-container *ngFor="let line of message.content.split('\n'); let isLast=last">
                        <span *ngFor="let word of line.split(' ')" class="w-full inline select-none"
                            [ngClass]="{'break-all': word.length > maxWidth}">
                            {{word}} <!-- Muestra las palabras de la línea -->
                        </span>
                        <!-- Si no es la última línea, agrega un salto de línea -->
                        <ng-container *ngIf="!isLast">
                            <br>
                        </ng-container>
                    </ng-container>
                    <span class="inline-block select-none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span
                        class="text-[9px] absolute right-0 bottom-[2px] text-end self-end select-none">{{message.sentTime
                        | timeOnly}}</span>
                </span>
                <!-- Ícono de corazón -->
                <i [ngClass]="{'scale-0': !message.liked, 'scale-110': message.liked, '-left-6': message.sender.id === currentUser.id, '-right-6': message.sender.id !== currentUser.id}"
                    class="fa fa-heart absolute transition-all py-[3px] duration-300 text-red-500"></i>
                <!-- Ícono de ojo -->
                <div *ngIf="messages[i].read && i === messages.length - 1 && message.sender.id === currentUser.id"
                    class="absolute items-center text-[12px] flex -bottom-5 right-1 gap-2">
                    <i class="fa fa-eye"></i>
                    <p>Seen</p>
                </div>
            </div>
        </div>
    </div>

    <div class="h-16 w-full flex px-4">
        <textarea type="text" name="message" id="message" placeholder="Type a message..." autocomplete="off"
            [(ngModel)]="messageContent" (keypress)="handleKey($event)"
            class="w-full items-center m-3 placeholder:italic placeholder:text-sm py-2 flex text rounded-md px-3 bg-white max-h-full h-10 focus:outline-none bg-opacity-80 backdrop-blur-md autogrow-textarea"></textarea>

        <button (click)="sendMessage()"
            class="bg-sky-600 m-3 py-2 h-10 rounded-md flex gap-2 items-center text-white px-4 hover:bg-sky-700 transition-all duration-300">
            Send
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-send-2" width="24" height="24"
                viewBox="0 0 24 24" stroke-width="1.5" stroke="white" fill="none" stroke-linecap="round"
                stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                    d="M4.698 4.034l16.302 7.966l-16.302 7.966a.503 .503 0 0 1 -.546 -.124a.555 .555 0 0 1 -.12 -.568l2.468 -7.274l-2.468 -7.274a.555 .555 0 0 1 .12 -.568a.503 .503 0 0 1 .546 -.124z" />
                <path d="M6.5 12h14.5" />
            </svg>
        </button>
    </div>
</div>